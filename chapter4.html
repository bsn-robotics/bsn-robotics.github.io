<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <link rel="stylesheet" href="style.css" type="text/css">
    <title>4chapter</title>
  </head>
  <body><page size="A4">
      <h1>4 Практическая реализация разработанных алгоритмов</h1>
      <h2>4.1 Робототехническая платформа для испытания разработанных алгоритмов</h2>
      <p>Робот представляет собой трехколесную платформу собственной разработки,
        основой платформы является гироскутер “Smartbalance 10”. Два колеса
        ведущие, третье колесо ведомое (см. рисунки 15, 16). Характеристики
        платформы приведены в таблице 1.<br>
      </p>
      <p class="western" style="margin-right: 0in; margin-bottom: 0in; line-height: 150%; widows: 2; orphans: 2"
        align="justify"> <br>
      </p>
      <table cellpadding="4" cellspacing="0" width="624">
        <colgroup><col width="614"> </colgroup>
        <tbody>
          <tr>
            <td style="border: 1px solid #000001; padding-top: 0.04in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in"
              bgcolor="#ffffff" valign="top" width="614"> <img longdesc="02" title="02"
                alt="02" src="img/chapter4_02.JPG"><br>
            </td>
          </tr>
          <tr>
            <td style="border-top: none; border-bottom: 1px solid #000001; border-left: 1px solid #000001; border-right: 1px solid #000001; padding-top: 0in; padding-bottom: 0.04in; padding-left: 0.04in; padding-right: 0.04in"
              bgcolor="#ffffff" valign="top" width="614">
              <p class="western" style="margin-right: 0in; widows: 2; orphans: 2"
                align="justify"> <font color="#000000"><font face="Times New Roman, serif"><font
                      style="font-size: 14pt" size="4">Рисунок 15 – Внешний вид
                      робототехнической платформы сзади</font></font></font></p>
            </td>
          </tr>
        </tbody>
      </table>
      <p class="western" style="margin-right: 0in; margin-bottom: 0in; line-height: 150%; widows: 2; orphans: 2"
        align="justify"> <br>
      </p>
      <table cellpadding="7" cellspacing="0" width="638">
        <colgroup><col width="622"> </colgroup>
        <tbody>
          <tr>
            <td style="border: 1px solid #000001; padding-top: 0in; padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in"
              valign="top" width="622">
              <p class="western" style="margin-right: 0in; widows: 2; orphans: 2"
                align="justify"> </p>
              <img longdesc="01" title="01" alt="01" src="img/chapter4_01.JPG"><br>
            </td>
          </tr>
          <tr>
            <td style="border: 1px solid #000001; padding-top: 0in; padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in"
              valign="top" width="622">
              <p class="western" style="margin-right: 0in; widows: 2; orphans: 2"
                align="justify"> <font color="#000000"><font face="Times New Roman, serif"><font
                      style="font-size: 14pt" size="4">Рисунок 16 – Внешний вид
                      робототехнической платформы спереди</font></font></font></p>
            </td>
          </tr>
        </tbody>
      </table>
      <p class="western" style="margin-right: 0in; margin-bottom: 0in; line-height: 150%; widows: 2; orphans: 2"
        align="justify"> <br>
      </p>
      Платформа оснащена бортовым аккумулятором напряжением 36 В для питания
      двух электродвигателей, а также аккумулятором 12 В для питания
      времепролетной камеры Kinect 2.0.
      <p>Таблица 1—Характеристики платформы собственной разработки<br>
      </p>
      <table cellpadding="7" cellspacing="0" width="657">
        <colgroup><col width="313"> <col width="313"> </colgroup>
        <tbody>
          <tr valign="top">
            <td style="border: 1px solid #000001; padding-top: 0in; padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in"
              width="313">
              <p class="western" style="margin-right: 0in; widows: 2; orphans: 2"
                align="justify"> <font color="#000000"><font face="Times New Roman, serif"><font
                      style="font-size: 14pt" size="4">Габаритные размеры</font></font></font></p>
            </td>
            <td style="border: 1px solid #000001; padding-top: 0in; padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in"
              width="313">
              <p class="western" style="margin-right: 0in; widows: 2; orphans: 2"
                align="justify"> <font color="#000000"><font face="Times New Roman, serif"><font
                      style="font-size: 14pt" size="4"><span lang="en-US">600</span>
                      <span lang="en-US">x 600 x 400 </span>мм</font></font></font></p>
            </td>
          </tr>
          <tr valign="top">
            <td style="border: 1px solid #000001; padding-top: 0in; padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in"
              width="313">
              <p class="western" style="margin-right: 0in; widows: 2; orphans: 2"
                align="justify"> <font color="#000000"><font face="Times New Roman, serif"><font
                      style="font-size: 14pt" size="4">Масса</font></font></font></p>
            </td>
            <td style="border: 1px solid #000001; padding-top: 0in; padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in"
              width="313">
              <p class="western" style="margin-right: 0in; widows: 2; orphans: 2"
                align="justify"> <font color="#000000"><font face="Times New Roman, serif"><font
                      style="font-size: 14pt" size="4">14 кг</font></font></font></p>
            </td>
          </tr>
          <tr valign="top">
            <td style="border: 1px solid #000001; padding-top: 0in; padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in"
              width="313">
              <p class="western" style="margin-right: 0in; widows: 2; orphans: 2"
                align="justify"> <font color="#000000"><font face="Times New Roman, serif"><font
                      style="font-size: 14pt" size="4">Максимальная скорость
                      перемещения</font></font></font></p>
            </td>
            <td style="border: 1px solid #000001; padding-top: 0in; padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in"
              width="313">
              <p class="western" style="margin-right: 0in; widows: 2; orphans: 2"
                align="justify"> <font color="#000000"><font face="Times New Roman, serif"><font
                      style="font-size: 14pt" size="4">2 м<span lang="en-US">/c</span></font></font></font></p>
            </td>
          </tr>
          <tr valign="top">
            <td style="border: 1px solid #000001; padding-top: 0in; padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in"
              width="313">
              <p class="western" style="margin-right: 0in; widows: 2; orphans: 2"
                align="justify"> <font color="#000000"><font face="Times New Roman, serif"><font
                      style="font-size: 14pt" size="4">Время автономной работы </font></font></font>
              </p>
            </td>
            <td style="border: 1px solid #000001; padding-top: 0in; padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in"
              width="313">
              <p class="western" style="margin-right: 0in; widows: 2; orphans: 2"
                align="justify"> <font color="#000000"><font face="Times New Roman, serif"><font
                      style="font-size: 14pt" size="4">4 ч</font></font></font></p>
            </td>
          </tr>
          <tr valign="top">
            <td style="border: 1px solid #000001; padding-top: 0in; padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in"
              width="313">
              <p class="western" style="margin-right: 0in; widows: 2; orphans: 2"
                align="justify"> <font color="#000000"><font face="Times New Roman, serif"><font
                      style="font-size: 14pt" size="4">Грузоподъемность</font></font></font></p>
            </td>
            <td style="border: 1px solid #000001; padding-top: 0in; padding-bottom: 0in; padding-left: 0.08in; padding-right: 0.08in"
              width="313">
              <p class="western" style="margin-right: 0in; widows: 2; orphans: 2"
                align="justify"> <font color="#000000"><font face="Times New Roman, serif"><font
                      style="font-size: 14pt" size="4">15 кг</font></font></font></p>
            </td>
          </tr>
        </tbody>
      </table>
      <p><br>
      </p>
      <p>Робот представляет собой трехколесную платформу собственной разработки,
        основой платформы является гироскутер "Smartbalance 10". Два колеса
        гироскутера являются ведущими</p>
      <p>На гироскутере установлена рама, разработанная для крепления третьего
        ведомого колеса, аккумулятора, а также профильной панели. На панели
        крепятся бортовая ЭВМ, стойка с времепролетной камерой, контроллер
        двигателей, переходник для питания камеры.</p>
      <p>Непосредственно на гироскутере установлена электронная плата
        собственной разработки - коммутатор. Коммутатор коммутирует сигнальные и
        силовые провода.</p>
      <p><br>
      </p>
      <p>Предварительно был проведен анализ работы гироскутера.</p>
      <h3>4.1.1Анализ работы гироскутера.</h3>
      <p>На рис. представлен общий вид гироскутера.</p>
      <p><img style="width: 718px; height: 341px;" longdesc="1" title="1" alt="1"
          src="img/chapter4_1.jpg"></p>
      <p>На рис. представлена общая <a href="https://ru.wikipedia.org/wiki/%D0%A1%D1%82%D1%80%D1%83%D0%BA%D1%82%D1%83%D1%80%D0%BD%D0%B0%D1%8F_%D1%81%D1%85%D0%B5%D0%BC%D0%B0">структурная</a>
        схема устройства гироскутера.</p>
      <img style="width: 697px; height: 351px;" longdesc="2" title="2" alt="2" src="img/chapter4_2.png">
      <p>Для того чтобы иметь возможность управлять гироскутером, с помощью
        логического анализатора был проанализирован протокол обмена данными
        между платами гироскопов и основной платой гироскутера.</p>
      <p>В результате протокол был идентифицирован, он представляет собой <a href="https://geektimes.ru/post/253786/">UART</a>
        RS-232, 9 бит, 1 стоп бит.</p>
      <p>Протокол(интерфейс) UART (Universal asynchronous receiver/transmitter)
        или УАПП (универсальный асинхронный приемопередатчик).</p>
      <p>Данные передаются <a href="http://ooep.kpi.ua/microcontrollers/rus/Downloads/LabWork_5.pdf">пакетами</a>
        по 9 бит.</p>
      <p>В таблице представлены характеристики протокола.</p>
      <p>Диаграмма протокола представлена на рис. (заменить рис. заглушку)</p>
      <img style="width: 776px; height: 233px;" title="3" alt="3" src="img/chapter4_3.png">
      <p>Каждые 300 мс циклически повторяется следующая последовательность
        пакетов:</p>
      <ol>
        <li>Команда разрешения. Имеет два значения - 170, при этом число,
          кодирующее угол наклона платы гироскопа, игнорируется в дальнейшем
          основной платой гироскутера. Значение - 85, при этом число, кодирующее
          угол наклона платы гироскопа, обрабатывается основной платой
          гироскутера.</li>
        <li>Фиксированное число 0</li>
        <li>Фиксированное число 0</li>
        <li>Фиксированное число 256</li>
        <li>Младшие 9 бит числа, кодирующего угол наклона платы гироскопа.</li>
        <li>Старшие 9 бит числа, кодирующего угол наклона.</li>
        <li>Повтор младших бит числа, кодирующего угол наклона.</li>
        <li>Повтор старших бит числа, кодирующего угол наклона.</li>
      </ol>
      <p>Угол наклона платы гироскопа прямопропорционален скважности ШИМ
        (Широтно-импульсная модуляция) сигнала, подающегося на обмотки
        электродвигателя, а следовательно угол наклона прямопропорционален и
        скорости вращения двигателя. </p>
      <p>Угол наклона задается 18-битным целым числом.</p>
      <p>Изменение угла наклоны платы, показано на рис.</p>
      <p>При анализе работы гироскутера замечены особенности управления, и
        выделены два режима работы:</p>
      <p>1. При задании угла наклона одного знака с обоих плат гироскопов,
        скорость двигателей достигает пропорциональной углу наклона, после чего
        через несколько секунд двигатели начинают ускоряться до максимально
        возможной скорости. Если угол наклона сохраняется то, скорость
        двигателей увеличивается чтобы компенсировать, наклон человека,
        управляющего гироскутером или чтобы увеличить скорость движения вперед.</p>
      <p>2. При задании угла наклона разного знака, скорость каждого из
        двигателей достигает скорости, пропорциональной углу наклона и остается
        неизменной.</p>
      <p>Проведенный анализ работы гироскутера показал, что стабильное
        управление гироскутером с помощью задания угла наклона, возможно только
        при втором режиме работы, когда углы наклона плат гироскопов имеют
        разные знаки и двигатели вращаются в разные стороны.</p>
      <p>Возникает проблема управления гироскутером при движении вперед и назад.</p>
      <h3>4.1.2 Модификация гироскутера.</h3>
      <p>Платы гироскопов были удалены. Вместо них для подачи команд управления
        на основную плату гироскутера и имитирования сигналов с плат гироскопов
        была установлена плата с микроконтроллером STM32, соединенная с бортовой
        ЭВМ по интерфейсу UART RS-232 8 bit.</p>
      <p>Для решения проблемы управления гироскутером при движении вперед и
        назад разработана электронная плата - коммутатор, аппаратно
        меняющая(реверсирующая) направление вращения правого двигателя по
        внешнему сигналу. Это достигается переключением фаз одного из
        двигателей, а также переключением сигналов с датчиков Холла,
        установленных на двигателе. Что позволяет задавать движение вперед и
        назад из второго режима работы гироскутера.</p>
      <p>Здесь и далее, при управлении имитируемый угол наклона платы гироскопа
        считается управляющим воздействием, пропорциональным скорости
        соответствующего двигателя.</p>
      <p>Общая структурная схема робота после модификаций имеет вид,
        представленный на рис.</p>
      <img style="width: 724px; height: 337px;" longdesc="4" title="4" alt="4" src="img/chapter4_4.png">
      <h3> </h3>
      <p>Схема алгоритма работы программы управления двигателями, представлена
        на рис. .</p>
      <img style="width: 385px; height: 531px;" longdesc="5" title="5" alt="5" src="img/chapter4_5.png">
      <p>Электрическая принципиальная схема коммутатора, реверсирующего правый
        двигатель по внешнему управляющему сигналу, представлена на рис.</p>
      <img style="width: 402px; height: 420px;" longdesc="7" title="7" alt="7" src="img/chapter4_7.png"><br>
      <p>Внешний вид платы коммутатора представлен на рис. (вставить фото) .</p>
      <h3><br>
      </h3>
      <h3>4.1.3 Разработка протокола управления скоростью двигателей</h3>
      <p></p>
      <p>Для передачи команд управления с бортовой ЭВМ на плату управления
        двигателями робота разработан протокол. Протокол использует интерфейс
        UART RS-232.</p>
      <table style="width: 100%" border="1">
        <tbody>
          <tr>
            <td>Бодрейт</td>
            <td>9600</td>
          </tr>
          <tr>
            <td>Количество информации в одном пакете </td>
            <td>8 бит</td>
          </tr>
          <tr>
            <td><br>
            </td>
            <td><br>
            </td>
          </tr>
          <tr>
            <td><br>
            </td>
            <td><br>
            </td>
          </tr>
        </tbody>
      </table>
      <p><br>
      </p>
      <p>Команды управления для моторов кодируется однобайтовым числом&nbsp;0 -
        255.</p>
      <p>Диапазон изменения скорости для левого и правого моторов: от -7 до +7.</p>
      <p> Для левого мотора используются 4 старших разряда числа, для правого
        мотора - 4 младших разряда числа.</p>
      <p>Рассмотрим 4 старших разряда для левого мотора:</p>
      <p>1111 - представление в двоичной системе счисления.</p>
      <p>Самый старший бит задает направление вращения колеса, 1 - вперед, 0 -
        назад.</p>
      <p>При вращении вперед скорость задается остальными тремя битами, двоичным
        числом от 001 до 111, т.е. 7 скоростей вперед. 001 - самая медленная,
        111 - самая быстрая.</p>
      <p>Для задания положительной скорости вращения назад скорость задается,
        двоичным числом от 111 до 001 , т.е. 7 скоростей назад. 111 - самая
        медленная, 001 - самая быстрая.</p>
      <p>Тоже самое для второго мотора.</p>
      <p>Пример принятого байта:</p>
      <p>1000 1000 - оба колеса не двигаются.</p>
      <p>1111 1111 - оба колеса вперед, с максимальной скоростью.</p>
      <p>0111 0111 - оба колеса назад, с минимальной скоростью.</p>
      <p>1001 0111 - левое колесо вперед с минимальной скоростью, правое назад с
        минимальной скоростью.</p>
      <p>0110 1101&nbsp; - левое колесо назад со скоростю 2, правое колесо
        вперед со скоростью 5.</p>
      <p>Управляющая команда 0000 0000 - инвертировать сигнал разрешения
        исполнения команд.</p>
      Комбинациии 10000000 и 00001000 - не определены и игнорируются.<br>
      <br>
      <h3>4.1.4 Бортовая ЭВМ</h3>
      <p>Мобильная платформа оснащена бортовой ЭВМ для управления и обработки
        информации с времепролетной камеры. Бортовая ЭВМ представляет собой
        ноутбук модели ASUS S300CA, внешний вид которого представлен на рис.<br>
        Выбор осуществлялся из необходимости размещения бортовой ЭВМ на
        мобильной платформе и мощности процессора установленного в ЭВМ, исходя
        из требований для использования реализации алгоритма SLAM.<br>
        В ЭВМ установлен процессор Intel Core i7, 4 Гб оперативной памяти и
        500Гб постоянной памяти.<br>
        Система технического зрения.<br>
        В качестве времепролетной (TOF) в задании на НИР была дана камера&nbsp;
        Microsoft Kinect 2.0, обладающая наибольшей коммерческой доступностью и
        простотой использования относительно других TOF-видеокамер.
        Характеристики Microsoft Kinect 2.0 приведены в таблице 2.<br>
        Microsoft Kinect 2.0 работает по принципу «range gated images»[]. В
        начальный момент времени включается освещение сцены инфракрасной
        подсветкой. Затвор инфракрасного приемника закрывается в момент времени
        t. Тогда объекты, расположенные дальше, чем t/(2c), где с – скорость
        света, не будут видны на камере . Свет не успевает отразиться от них до
        закрытия затвора. Точка, расположенная вплотную к камере будет
        освещаться всё время экспозиции t и иметь яркость I. Следовательно,
        любая точка экспозиции будет иметь яркость от 0 до I, и эта яркость
        будет репрезентацией расстояния до точки. Чем ярче точка – тем ближе
        объект. Для увеличения точности и дальности действия в Kinect 2.0
        используется последовательность вспышек с разным временем срабатывания
        затвора приемника[].</p>
      <h3>4.1.4 Времепролетная камера</h3>
      <p>В качестве времепролетной (TOF) в задании на НИР была дана камера
        Microsoft Kinect 2.0, обладающая наибольшей коммерческой доступностью и
        простотой использования относительно других TOF-видеокамер.
        Характеристики Microsoft Kinect 2.0 приведены в таблице 2.<br>
        Microsoft Kinect 2.0 работает по принципу «range gated images»[]. В
        начальный момент времени включается освещение сцены инфракрасной
        подсветкой. Затвор ифракрасного приемника закрывается в момент времени
        t. Тогда объекты, расположенные дальше, чем t/(2c), где с – скорость
        света, не будут видны на камере . Свет не успевает отразиться от них до
        закрытия затвора. Точка, расположенная вплотную к камере будет
        освещаться всё время экспозиции t и иметь яркость I. Следовательно,
        любая точка экспозиции будет иметь яркость от 0 до I, и эта яркость
        будет репрезентацией расстояния до точки. Чем ярче точка – тем ближе
        объект. Для увеличения точности и дальности действия в Kinect 2.0
        используется последовательность вспышек с разным временем срабатывания
        затвора приемника[].</p>
      <p></p>
      <br>
      <h2>4.2 Программное обеспечение для реализации алгоритмов</h2>
      Для реализации разработанных алгоритмов выбран программный пакет ROS
      (Robot Operating System). Выбор ROS для разработки определён по следующим
      причинам – удобство разработки и использования, универсальность,
      модульность, открытый программный код, возможность использования готовых
      пакетов. Для ROS доступны удобные инструменты сбора информации с датчиков
      в процессе работы системы.<br>
      <br>
      4.2.1 Robot Operating System<br>
      <a style="color: #cc0000;" href="%D0%94%D0%B8%D0%BF%D0%BB%D0%BE%D0%BC+%D0%91%D0%B0%D0%BB%D1%82%D0%B0%D1%88%D0%BE%D0%B2%D0%B0">ROS
        (Robot Operating System) [] – программный пакет для роботов с открытым
        исходным кодом (лицензия BSD). Он не заменяет операционную систему, но
        расширяет ее набором модулей, необходимых для управления РТС. </a><br>
      <a style="color: #cc0000;" href="%D0%94%D0%B8%D0%BF%D0%BB%D0%BE%D0%BC+%D0%91%D0%B0%D0%BB%D1%82%D0%B0%D1%88%D0%BE%D0%B2%D0%B0">Основной
        целью ROS является поддержка повторного использованиякода в
        робототехнических исследованиях и разработках. ROS состоит из двух
        частей: ядро ROS – минимально необходимый для работы набор инструментов,
        модулей и библиотек; и набор развиваемых пользователями пакетов, которые
        реализуют различные функции робототехники: работа с оборудованием,
        обработка информации, моделирование, навигация и многое другое.<br>
        Ядро ROS разработано так, чтобы как можно меньше зависеть от архитектуры
        конечной системы. Граф вычислений ROS представляет собой одноранговую
        сеть процессов (узлов в терминологии ROS), которые обрабатывают данные
        совместно. Узлы могут обмениваться данными несколькими способами: через
        системные сообщения (темы в терминологии ROS), сервисы или сервер
        параметров. Структура данных и логика обмена может быть любой. При
        старте узлы сообщают свои регистрационные данные мастер-узлу, который
        хранит регистрационную информацию. От него узлы могут получить
        информацию о других зарегистрированных узлах и наладить с ними связь
        напрямую через согласованный протокол обмена (наиболее распространен в
        ROS протокол TCPROS, в основе которого лежит TCP/IP). Мастер информирует
        узлы об изменениях в системе ROS, что позволяет динамически создавать
        соединения при старте новых узлов. Узлы могут располагаться на различных
        компьютерах, и топология системы может изменяться в процессе работы без
        необходимости перекомпиляции. В отличие от других решений, код ROS
        максимально гибкий - он не накладывает ограничений на тип приложений,
        использованные узлы, структуру связи узлов и цикл работы. <br>
        ROS не зависит от языка программирования, клиентские библиотеки уже
        реализованы для Python, C++, Lisp, существуют экспериментальные
        библиотеки для Java и Lua []. Такой подход позволяет ROS легко
        интегрироваться с различными архитектурами и строить системы различной
        сложности поверх нее.</a><br>
      <br>
      <br>
      <p> 4.2.2 Реализация алгоритма планирования пути<br>
        <a style="color: #cc0000;" href="Baltash"><br>
          Предложенный АМПП реализован на языке C++ с использованием средств,
          входящих в состав программного пакета ROS. На рисунке 8 приведена
          упрощённая блок-схема узлов ROS разработанной системы.</a></p>
      <p> На рисунке представлен результат работы алгоритма RTAB-Map</p>
    </page>
  </body>
</html>
